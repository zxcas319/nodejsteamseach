var express    = require('express');
var mysql      = require('mysql');
var dbconfig   = require('./config/database.js');
var connection = mysql.createConnection(dbconfig);
var bodyParser = require('body-parser');
var http = require('http');

var app = express();
var router = express.Router();
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended: false}));

app.set('port', process.env.PORT || 33018);



app.post('/main', function(req, res){
  console.log('-------main--------');
  var companyTargetId =req.body.id;
  var companyTargetPw =req.body.pw;
  
  console.log("body:",req.body);
  //서버에서 confirm = 1 이고 해당 id의 pw가 일치할 때 가져오게 처리
  connection.query('SELECT confirm from user WHERE login_id=? and login_pw=?',[companyTargetId,companyTargetPw], function(err, rows) {
    if(err) throw err;
    console.log("body:",req.body);
    console.log("rows:",rows);
    //일치하는 쿼리값이 있을때
    if(rows[0]!=null && companyTargetId && companyTargetPw){ 
    
    //res.write(rows[0].confirm+"");
    res.write(rows[0].confirm+"");
  }
    
     // 없을 때
    else{
      res.write("");
    }
      
    res.end();
    
  });

});


app.listen(app.get('port'), function () {
  console.log('Express server listening on port ' + app.get('port'));
});
